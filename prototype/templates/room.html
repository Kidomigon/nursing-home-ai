<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Room {{ room_id }} â€” {{ resident_name }}</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <div class="room-layout">

    <!-- Orientation Bar -->
    <header class="orientation-bar">
      <div>
        <div class="room-label">Room {{ room_id }}</div>
        <div class="resident-name">{{ resident_name }}</div>
      </div>
      <div class="clock-area">
        <div class="clock-time" id="live-clock">{{ current_time }}</div>
        <div class="clock-date" id="live-date">{{ current_day }}, {{ current_date }}</div>
      </div>
    </header>

    <!-- Call for Help -->
    <div class="help-section">
      <form id="help-form" method="post" action="/room/{{ room_id }}/help">
        <input type="hidden" name="resident_name" value="{{ resident_name }}" />
        <button type="submit" class="help-btn" id="help-btn">Call for Help</button>
      </form>
    </div>

    {% if mode == 'memory_support' %}
    <!-- Memory Support Orientation -->
    <div class="memory-card">
      <strong>You are in Room {{ room_id }} at your care home.</strong>
      It is {{ current_day }}. I'm here to help you with anything you need.
    </div>
    {% endif %}

    <!-- Chat Area -->
    <div class="chat-area" id="chat-messages">
      <!-- Thinking indicator (hidden by default) -->
      <div class="thinking-indicator" id="thinking-indicator">
        <div class="thinking-dots">
          <span></span><span></span><span></span>
        </div>
        Room Companion is thinking...
      </div>
      <div class="slow-thinking" id="slow-thinking">Still thinking, one moment...</div>
    </div>

    <!-- Input Bar -->
    <div class="input-bar">
      <button class="icon-btn mute-btn" id="mute-btn" type="button" aria-label="Mute voice">
        <span class="mute-icon">&#x1F50A;</span>
      </button>
      <div class="mic-indicator" id="mic-indicator">
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
      </div>
      <input type="text" id="chat-input" placeholder="Type a message or tap the mic..." autocomplete="off" />
      <button class="icon-btn mic-btn" id="mic-btn" type="button" aria-label="Start voice input">&#x1F3A4;</button>
      <button class="icon-btn send-btn" id="send-btn" type="button" aria-label="Send message">&#x27A4;</button>
    </div>

    <div class="room-nav">
      <a href="/staff">Staff Portal</a>
    </div>

  </div>

  <!-- Help Confirmation Overlay -->
  <div class="help-overlay" id="help-overlay">
    <div class="help-overlay-icon">&#x2705;</div>
    <div class="help-overlay-text">Help is on the way</div>
    <div class="help-overlay-severity"></div>
  </div>

  <!-- Config for JS -->
  <script>
    window.ROOM_CONFIG = {
      roomId: "{{ room_id }}",
      residentName: "{{ resident_name }}",
      mode: "{{ mode }}",
      greeting: "{{ greeting | e }}"
    };
  </script>
  <script src="/static/voice.js"></script>
  <script src="/static/app.js"></script>
</body>
</html>
