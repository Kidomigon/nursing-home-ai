<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Staff Portal ‚Äì Prototype</title>
  <link rel="stylesheet" href="/static/style.css" />
  <meta http-equiv="refresh" content="10" />
</head>
<body class="staff">
  <div class="container">
    <h1>Staff Portal</h1>
    <p class="note">Prototype view ‚Äì refreshes every 10 seconds.</p>

    <p class="note">Rooms: 
      <a href="/room/101">101</a> |
      <a href="/room/102">102</a> |
      <a href="/room/103">103</a>
      &nbsp;|&nbsp; View alerts for:
      <a href="/staff">All</a> /
      <a href="/staff?room_id=101">101</a> /
      <a href="/staff?room_id=102">102</a> /
      <a href="/staff?room_id=103">103</a>
    </p>

    <p class="note">Help alerts (last 30 min):
      101 ‚Äì {{ room_help_counts['101'] }}{% if room_help_counts['101'] >= 3 %}!{% endif %} |
      102 ‚Äì {{ room_help_counts['102'] }}{% if room_help_counts['102'] >= 3 %}!{% endif %} |
      103 ‚Äì {{ room_help_counts['103'] }}{% if room_help_counts['103'] >= 3 %}!{% endif %}
    </p>

    <p class="note">Orientation questions (last 7 days):
      101 ‚Äì {{ room_orientation_counts['101'] }}{% if room_orientation_counts['101'] >= 10 %}!{% endif %} |
      102 ‚Äì {{ room_orientation_counts['102'] }}{% if room_orientation_counts['102'] >= 10 %}!{% endif %} |
      103 ‚Äì {{ room_orientation_counts['103'] }}{% if room_orientation_counts['103'] >= 10 %}!{% endif %}
    </p>

    <p class="note">(Rough count of "where am I / what time / what day" style questions ‚Äì a simple confusion signal, not a diagnosis. "!" means unusually high.)</p>

    <p class="note">Source icons: ‚óè button call, üé§ voice/question, ? other, - not a help alert.</p>

    {% if alerts %}
      <table class="alerts-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Time (UTC)</th>
            <th>Room</th>
            <th>Resident</th>
            <th>Mode</th>
            <th>Type</th>
            <th>Source</th>
            <th>Status</th>
            <th>Message</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
        {% for alert in alerts %}
          <tr class="status-{{ alert.status }}">
            <td>{{ alert.id }}</td>
            <td>{{ alert.created_at }}</td>
            <td>{{ alert.room_id }}</td>
            <td>{{ alert.resident_name }}</td>
            <td>{% if alert.mode == 'memory_support' %}Memory Support{% else %}Standard{% endif %}</td>
            <td>{{ alert.type }}</td>
            <td>
              {% if alert.type == 'help' %}
                {% if alert.message.startswith('Resident requested help via button') %}
                  ‚óè
                {% elif alert.message.startswith('Possible distress from question input') %}
                  üé§
                {% else %}
                  ?
                {% endif %}
              {% else %}
                -
              {% endif %}
            </td>
            <td>{{ alert.status }}</td>
            <td>{{ alert.message }}</td>
            <td>
              <form method="post" action="/staff/alerts/{{ alert.id }}/ack" style="display:inline;">
                <button type="submit" class="btn btn-small" {% if alert.status != 'new' %}disabled{% endif %}>Ack</button>
              </form>
              <form method="post" action="/staff/alerts/{{ alert.id }}/resolve" style="display:inline;">
                <button type="submit" class="btn btn-small" {% if alert.status == 'resolved' %}disabled{% endif %}>Resolve</button>
              </form>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>No alerts yet.</p>
    {% endif %}

    <p class="link"><a href="/room">Back to room view</a></p>
  </div>
</body>
</html>
